dependenciesLoader(["CodeMirror"],function(){!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(z){function E(c,a){return"pairs"==a&&"string"==typeof c?c:"object"==typeof c&&null!=c[a]?c[a]:D[a]}function m(a){return function(c){return F(c,a)}}function b(c){var a=c.state.closeBrackets;if(!a){return null}var d=c.getModeAt(c.getCursor());return d.closeBrackets||a}function v(r){var e=b(r);if(!e||r.getOption("disableInput")){return z.Pass}for(var d=E(e,"pairs"),p=r.listSelections(),g=0;g<p.length;g++){if(!p[g].empty()){return z.Pass}var c=B(r,p[g].head);if(!c||d.indexOf(c)%2!=0){return z.Pass}}for(var g=p.length-1;g>=0;g--){var h=p[g].head;r.replaceRange("",w(h.line,h.ch-1),w(h.line,h.ch+1))}}function C(h){var e=b(h),d=e&&E(e,"explode");if(!d||h.getOption("disableInput")){return z.Pass}for(var g=h.listSelections(),f=0;f<g.length;f++){if(!g[f].empty()){return z.Pass}var c=B(h,g[f].head);if(!c||d.indexOf(c)%2!=0){return z.Pass}}h.operation(function(){h.replaceSelection("\n\n",null),h.execCommand("goCharLeft"),g=h.listSelections();for(var i=0;i<g.length;i++){var a=g[i].head.line;h.indentLine(a,null,!0),h.indentLine(a+1,null,!0)}})}function k(a){var c=z.cmpPos(a.anchor,a.head)>0;return{anchor:new w(a.anchor.line,a.anchor.ch+(c?-1:1)),head:new w(a.head.line,a.head.ch+(c?1:-1))}}function F(h,t){var M=b(h);if(!M||h.getOption("disableInput")){return z.Pass}var Q=E(M,"pairs"),J=Q.indexOf(t);if(-1==J){return z.Pass}for(var O,I,H=E(M,"triples"),f=Q.charAt(J+1)==t,N=h.listSelections(),l=J%2==0,K=0;K<N.length;K++){var L,e=N[K],G=e.head,I=h.getRange(G,w(G.line,G.ch+1));if(l&&!e.empty()){L="surround"}else{if(!f&&l||I!=t){if(f&&G.ch>1&&H.indexOf(t)>=0&&h.getRange(w(G.line,G.ch-2),G)==t+t&&(G.ch<=2||h.getRange(w(G.line,G.ch-3),w(G.line,G.ch-2))!=t)){L="addFour"}else{if(f){if(z.isWordChar(I)||!y(h,G,t)){return z.Pass}L="both"}else{if(!l||h.getLine(G.line).length!=G.ch&&!q(I,Q)&&!/\s/.test(I)){return z.Pass}L="both"}}}else{L=H.indexOf(t)>=0&&h.getRange(G,w(G.line,G.ch+3))==t+t+t?"skipThree":"skip"}}if(O){if(O!=L){return z.Pass}}else{O=L}}var r=J%2?Q.charAt(J-1):t,o=J%2?t:Q.charAt(J+1);h.operation(function(){if("skip"==O){h.execCommand("goCharRight")}else{if("skipThree"==O){for(var c=0;3>c;c++){h.execCommand("goCharRight")}}else{if("surround"==O){for(var a=h.getSelections(),c=0;c<a.length;c++){a[c]=r+a[c]+o}h.replaceSelections(a,"around"),a=h.listSelections().slice();for(var c=0;c<a.length;c++){a[c]=k(a[c])}h.setSelections(a)}else{"both"==O?(h.replaceSelection(r+o,null),h.triggerElectric(r+o),h.execCommand("goCharLeft")):"addFour"==O&&(h.replaceSelection(r+r+r+r,"before"),h.execCommand("goCharRight"))}}}})}function q(c,a){var d=a.lastIndexOf(c);return d>-1&&d%2==1}function B(c,a){var d=c.getRange(w(a.line,a.ch-1),w(a.line,a.ch+1));return 2==d.length?d:null}function y(e,l,g){var d=e.getLine(l.line),c=e.getTokenAt(l);if(/\bstring2?\b/.test(c.type)){return !1}var h=new z.StringStream(d.slice(0,l.ch)+g+d.slice(l.ch),4);for(h.pos=h.start=c.start;;){var f=e.getMode().token(h,c.state);if(h.pos>=l.ch+1){return/\bstring2?\b/.test(f)}h.start=h.pos}}var D={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},w=z.Pos;z.defineOption("autoCloseBrackets",!1,function(a,d,c){c&&c!=z.Init&&(a.removeKeyMap(x),a.state.closeBrackets=null),d&&(a.state.closeBrackets=d,a.addKeyMap(x))});for(var A=D.pairs+"`",x={Backspace:v,Enter:C},j=0;j<A.length;j++){x["'"+A.charAt(j)+"'"]=m(A.charAt(j))}})});